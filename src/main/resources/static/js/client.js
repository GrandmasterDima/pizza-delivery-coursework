//–§—É–Ω–∫—Ü—ñ—è –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É —É –∫–æ—à–∏–∫
// –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –∑ HTML –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –Ω–∞ –∫–Ω–æ–ø–∫—É +
function addToCart(button) {
    //–ó–±–∏—Ä–∞—î–º–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ø—ñ—Ü—É –∑ HTML-–∞—Ç—Ä–∏–±—É—Ç—ñ–≤ –∫–Ω–æ–ø–∫–∏
    //–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ getAttribute, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –¥–∞–Ω—ñ,
    //—è–∫—ñ –∑–∞—à–∏–ª–∏ –≤ –∫–Ω–æ–ø–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ.
    const product = {
        id: button.getAttribute('data-id'),
        name: button.getAttribute('data-name'),
        price: button.getAttribute('data-price'),
        img: button.getAttribute('data-img'),
        quantity: 1
    };

    // –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω –∫–æ—à–∏–∫–∞
    // localStorage.getItem –ø–æ–≤–µ—Ä—Ç–∞—î —Ä—è–¥–æ–∫ (String), —Ç–æ–º—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ JSON.parse,
    // —â–æ–± –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ –π–æ–≥–æ –Ω–∞–∑–∞–¥ —É –º–∞—Å–∏–≤ –æ–±'—î–∫—Ç—ñ–≤ JavaScript.
    // "|| []" –æ–∑–Ω–∞—á–∞—î: —è–∫—â–æ –≤ –ø–∞–º'—è—Ç—ñ  null, —Å—Ç–≤–æ—Ä–∏—Ç–∏ –ø–æ—Ä–æ–∂–Ω—ñ–π –º–∞—Å–∏–≤.
    let cart = JSON.parse(localStorage.getItem('pizzaCart')) || [];

    //–ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —Ü–µ–π —Ç–æ–≤–∞—Ä –≤–∂–µ —î –≤ –∫–æ—à–∏–∫—É
    // findIndex –ø–æ–≤–µ—Ä–Ω–µ —ñ–Ω–¥–µ–∫—Å —Ç–æ–≤–∞—Ä—É (0, 1, 2...), —è–∫—â–æ –∑–Ω–∞–π–¥–µ –π–æ–≥–æ –∑–∞ ID.
    // –Ø–∫—â–æ —Ç–æ–≤–∞—Ä—É –Ω–µ–º–∞—î, –ø–æ–≤–µ—Ä–Ω–µ -1.
    const existingProductIndex = cart.findIndex(item => item.id === product.id);

    if (existingProductIndex > -1) {
        // –Ø–∫—â–æ —Ç–æ–≤–∞—Ä –≤–∂–µ —î
        // –ú–∏ –Ω–µ –¥–æ–¥–∞—î–º–æ –¥—É–±–ª—ñ–∫–∞—Ç, –∞ –ø—Ä–æ—Å—Ç–æ –∑–±—ñ–ª—å—à—É—î–º–æ –ø–æ–ª–µ quantity —É —ñ—Å–Ω—É—é—á–æ–≥–æ —Ç–æ–≤–∞—Ä—É.
        cart[existingProductIndex].quantity += 1;
    } else {
        // –Ø–∫—â–æ —Ç–æ–≤–∞—Ä—É –Ω–µ–º–∞—î
        // –î–æ–¥–∞—î–º–æ –Ω–æ–≤–∏–π –æ–±'—î–∫—Ç —É –∫—ñ–Ω–µ—Ü—å –º–∞—Å–∏–≤—É
        cart.push(product);
    }

    //–ó–±–µ—Ä—ñ–≥–∞—î–º–æ –æ–Ω–æ–≤–ª–µ–Ω–∏–π –∫–æ—à–∏–∫ –Ω–∞–∑–∞–¥ —É –ø–∞–º'—è—Ç—å –±—Ä–∞—É–∑–µ—Ä–∞
    // JSON.stringify –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î –º–∞—Å–∏–≤ –Ω–∞–∑–∞–¥ —É —Ä—è–¥–æ–∫, –±–æ localStorage —Ä–æ–∑—É–º—ñ—î —Ç—ñ–ª—å–∫–∏ —Ä—è–¥–∫–∏.
    localStorage.setItem('pizzaCart', JSON.stringify(cart));

    //–í—ñ–∑—É–∞–ª—å–Ω–∏–π –µ—Ñ–µ–∫—Ç
    // –ó–º—ñ–Ω—é—î–º–æ —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –Ω–∞ –≥–∞–ª–æ—á–∫—É —Ç–∞ –∫–æ–ª—ñ—Ä –Ω–∞ –∑–µ–ª–µ–Ω–∏–π
    button.innerText = '‚úì';
    button.style.backgroundColor = '#4CAF50';

    // –ß–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ –∫–Ω–æ–ø—Ü—ñ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –≤–∏–≥–ª—è–¥
    setTimeout(() => {
        button.innerText = '+';
        button.style.backgroundColor = ''; // –ü–æ—Ä–æ–∂–Ω—ñ–π —Ä—è–¥–æ–∫ —Å–∫–∏–¥–∞—î inline-—Å—Ç–∏–ª—å
    }, 1000);

    // –û–¥—Ä–∞–∑—É –æ–Ω–æ–≤–ª—é—î–º–æ —á–µ—Ä–≤–æ–Ω—É —Ü–∏—Ñ—Ä—É –Ω–∞ –∫–æ—à–∏–∫—É, —â–æ–± –∫–ª—ñ—î–Ω—Ç –±–∞—á–∏–≤ –∑–º—ñ–Ω–∏
    updateCartCounter();
}
//–û–Ω–æ–≤–ª–µ–Ω–Ω—è –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞
function updateCartCounter() {
    // –ó–Ω–æ–≤—É —á–∏—Ç–∞—î–º–æ –∫–æ—à–∏–∫, —â–æ–± –ø–æ—Ä–∞—Ö—É–≤–∞—Ç–∏ –∞–∫—Ç—É–∞–ª—å–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å
    const cart = JSON.parse(localStorage.getItem('pizzaCart')) || [];

    // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –º–µ—Ç–æ–¥ .reduce() –¥–ª—è –ø—ñ–¥—Ä–∞—Ö—É–Ω–∫—É —Å—É–º–∏.
    // sum - –Ω–∞–∫–æ–ø–∏—á—É–≤–∞—á, item - –∫–æ–∂–Ω–∞ –ø—ñ—Ü–∞. –ú–∏ –¥–æ–¥–∞—î–º–æ item.quantity –¥–æ —Å—É–º–∏.
    // 0 - —Ü–µ –ø–æ—á–∞—Ç–∫–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è —Å—É–º–∏.
    const totalCount = cart.reduce((sum, item) => sum + item.quantity, 0);

    // –®—É–∫–∞—î–º–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä , –∫—É–¥–∏ –≤—Å—Ç–∞–≤–∏—Ç–∏ —Ü–∏—Ñ—Ä—É
    const wrapper = document.getElementById('cart-wrapper');

    // –Ø–∫—â–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–Ω–∞–π–¥–µ–Ω–æ (–∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ –ø–æ–º–∏–ª–æ–∫ –Ω–∞ —ñ–Ω—à–∏—Ö —Å—Ç–æ—Ä—ñ–Ω–∫–∞—Ö)
    if (wrapper) {
        // –°–ø–æ—á–∞—Ç–∫—É –≤–∏–¥–∞–ª—è—î–º–æ —Å—Ç–∞—Ä–∏–π –∫—Ä—É–∂–µ—á–æ–∫, —â–æ–± —Ü–∏—Ñ—Ä–∏ –Ω–µ –Ω–∞–∫–ª–∞–¥–∞–ª–∏—Å—è –æ–¥–Ω–∞ –Ω–∞ –æ–¥–Ω—É
        let oldBadge = document.getElementById('cart-badge');
        if (oldBadge) oldBadge.remove();

        //–Ø–∫—â–æ —Ç–æ–≤–∞—Ä—ñ–≤ –±—ñ–ª—å—à–µ 0, —Å—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π –∫—Ä—É–∂–µ—á–æ–∫
        if (totalCount > 0) {
            let badge = document.createElement('span');
            badge.id = 'cart-badge';
            badge.innerText = totalCount; // –ó–∞–ø–∏—Å—É—î–º–æ –≤—Å–µ—Ä–µ–¥–∏–Ω—É —Ü–∏—Ñ—Ä—É

            // –ó–∞–¥–∞—î–º–æ —Å—Ç–∏–ª—ñ –ø—Ä—è–º–æ —á–µ—Ä–µ–∑ JS, –±–æ –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑–º—ñ–Ω—é—î—Ç—å—Å—è
            // pointer-events: none –≤–∞–∂–ª–∏–≤–∏–π, —â–æ–± –∫–ª—ñ–∫ –ø—Ä–æ—Ö–æ–¥–∏–≤ –∫—Ä—ñ–∑—å —Ü–∏—Ñ—Ä—É –Ω–∞ —Å–∞–º—É —ñ–∫–æ–Ω–∫—É –∫–æ—à–∏–∫–∞
            badge.style.cssText = `
                position: absolute;
                top: -5px;
                right: -5px;
                background-color: #ff4757;
                color: white;
                border-radius: 50%;
                padding: 2px 6px;
                font-size: 12px;
                font-weight: bold;
                pointer-events: none;
            `;
            // –î–æ–¥–∞—î–º–æ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π <span> –≤—Å–µ—Ä–µ–¥–∏–Ω—É <div> –æ–±–≥–æ—Ä—Ç–∫–∏
            wrapper.appendChild(badge);
        }
    }
}
//–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è (–≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é)
function checkAuthStatus() {
    // –ß–∏—Ç–∞—î–º–æ –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —è–∫—ñ –º–∏ –∑–±–µ—Ä–µ–≥–ª–∏ –ø—Ä–∏ –≤—Ö–æ–¥—ñ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ Login
    const user = JSON.parse(localStorage.getItem('currentUser'));
    // –®—É–∫–∞—î–º–æ –æ–±–≥–æ—Ä—Ç–∫—É –¥–ª—è —ñ–∫–æ–Ω–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    const wrapper = document.getElementById('user-wrapper');
    if (!wrapper) return; // –Ø–∫—â–æ –º–∏ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ, –¥–µ –Ω–µ–º–∞—î —Ö–µ–¥–µ—Ä–∞, –≤–∏—Ö–æ–¥–∏–º–æ
    // –ü–æ–≤–Ω—ñ—Å—Ç—é –æ—á–∏—â–∞—î–º–æ –≤–º—ñ—Å—Ç –æ–±–≥–æ—Ä—Ç–∫–∏ –ø–µ—Ä–µ–¥ –º–∞–ª—é–≤–∞–Ω–Ω—è–º
    wrapper.innerHTML = '';
    if (user) {
        //–Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —É–≤—ñ–π—à–æ–≤
        //–ó–∞–º—ñ—Å—Ç—å —ñ–∫–æ–Ω–∫–∏ –º–∞–ª—é—î–º–æ –Ü–º'—è —Ç–∞ –∫–Ω–æ–ø–∫—É –¥–ª—è –≤–∏—Ö–æ–¥—É
        wrapper.innerHTML = `
            <div style="display: flex; flex-direction: column; align-items: flex-end; line-height: 1.2;">
                <span style="font-weight: 600; font-size: 14px; color: #193948;">üë§ ${user.name}</span>
                <span id="btn-logout" style="color: #d32f2f; font-size: 12px; text-decoration: underline;">–í–∏–π—Ç–∏</span>
            </div>
        `;

        // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –ø–æ–¥—ñ–π –Ω–∞ –∫–Ω–æ–ø–∫—É –≤–∏–π—Ç–∏
        document.getElementById('btn-logout').addEventListener('click', (e) => {
            // e.stopPropagation() –∑—É–ø–∏–Ω—è—î —Å–ø–ª–∏–≤–∞–Ω–Ω—è –∫–ª—ñ–∫—É.
            // –ë–µ–∑ —Ü—å–æ–≥–æ –∫–ª—ñ–∫ –ø–æ –∫–Ω–æ–ø—Ü—ñ –≤–∏–π—Ç–∏ —Ç–∞–∫–æ–∂ –∑–∞—Ä–∞—Ö—É–≤–∞–≤—Å—è –± —è–∫ –∫–ª—ñ–∫ –ø–æ user-wrapper,
            // —â–æ –º–æ–≥–ª–æ –± –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –Ω–µ–±–∞–∂–∞–Ω—ñ –ø–µ—Ä–µ—Ö–æ–¥–∏.
            e.stopPropagation();
            logout();
        });

    } else {
        //–Ø–∫—â–æ –ø—Ä–æ—Å—Ç–æ –≥—ñ—Å—Ç—å
        //–ú–∞–ª—é—î–º–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É SVG —ñ–∫–æ–Ω–∫—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        wrapper.innerHTML = `
            <svg class="header-user" width="36" height="36" style="display: block;">
                <use href="/images/icons.svg#user"></use>
            </svg>
        `;
        // –Ø–∫—â–æ –∫–ª—ñ–∫–Ω—É—Ç–∏ –Ω–∞ –æ–±–≥–æ—Ä—Ç–∫—É -> –ø–µ—Ä–µ—Ö–æ–¥–∏–º–æ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É –≤—Ö–æ–¥—É
        wrapper.onclick = () => window.location.href = '/login';
    }
}
// –§—É–Ω–∫—Ü—ñ—è –≤–∏—Ö–æ–¥—É –∑ —Å–∏—Å—Ç–µ–º–∏
function logout() {
    if(confirm("–í–∏–π—Ç–∏ –∑ –∞–∫–∞—É–Ω—Ç—É?")) {
        //–í–∏–¥–∞–ª—è—î–º–æ –∑–∞–ø–∏—Å –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –ø–∞–º'—è—Ç—ñ
        localStorage.removeItem('currentUser');
        //–ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –≥–æ–ª–æ–≤–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É, —â–æ–± —ñ–∫–æ–Ω–∫–∞ –æ–Ω–æ–≤–∏–ª–∞—Å—è –Ω–∞–∑–∞–¥ –Ω–∞ –≥–æ—Å—Ç—è
        window.location.href = '/';
    }
}
//–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
//–¶–µ–π –∫–æ–¥ —Å–ø—Ä–∞—Ü—é—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ, –∫–æ–ª–∏ HTML –ø–æ–≤–Ω—ñ—Å—Ç—é –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç—å—Å—è
document.addEventListener('DOMContentLoaded', () => {
    //–û–Ω–æ–≤–ª—é—î–º–æ —Ü–∏—Ñ—Ä—É –Ω–∞ –∫–æ—à–∏–∫—É —Ä–∞–ø—Ç–æ–º —Ç–∞–º –≤–∂–µ —î —Ç–æ–≤–∞—Ä–∏ –∑ –º–∏–Ω—É–ª–æ–≥–æ —Ä–∞–∑—É
    updateCartCounter();
    //–ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —Ö—Ç–æ –∑–∞–π—à–æ–≤ –ì—ñ—Å—Ç—å —á–∏ –Æ–∑–µ—Ä —ñ –º–∞–ª—é—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—É —ñ–∫–æ–Ω–∫—É
    checkAuthStatus();

    //–ù–∞–ª–∞—à—Ç–æ–≤—É—î–º–æ –∫–ª—ñ–∫ –ø–æ –∫–æ—à–∏–∫—É
    // –ú–∏ —Ä–æ–±–∏–º–æ —Ü–µ —Ç—É—Ç, –∞ –Ω–µ –≤ HTML, —â–æ–± –º–∞—Ç–∏ –±—ñ–ª—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—é
    const cartWrapper = document.getElementById('cart-wrapper');
    if (cartWrapper) {
        // –ü—Ä–∏ –∫–ª—ñ–∫—É –ø–µ—Ä–µ—Ö–æ–¥–∏–º–æ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É /cart
        cartWrapper.onclick = () => window.location.href = '/cart';
    }
});